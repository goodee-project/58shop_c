<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="goodee.gdj58.shop_c.mapper.CartMapper">

	<!--  4-2) 장바구니 총 상품 개수 -->
	<select id="cartQuantitySum" resultType="java.util.Map" parameterType="String">
		SELECT SUM(t.cartQuantity) sumQuantity
		FROM (SELECT c.cart_no cartNo
					, c.cart_quantity cartQuantity
					, go.goods_option_no goodsOptionNo
					, g.goods_price goodsPrice
				FROM shopping_cart c
				INNER JOIN shopping_goods_option go ON c.goods_option_no = go.goods_option_no
				INNER JOIN shopping_goods g ON go.goods_no = g.goods_no
		WHERE c.customer_id = #{customerId}) t	 
	</select>

	<!--  4-1) 주문시 cart delete -->
	<delete id="deleteCartAll" parameterType="String">
		DELETE 
		FROM shopping_cart 
		WHERE customer_id = #{customeId} 
	</delete>
	 
	<!--  4) cart delete -->
	<delete id="deleteCart" parameterType="int">
		DELETE 
		FROM shopping_cart 
		WHERE cart_no = #{cartNo} AND customer_id = #{customeId} 
	</delete>	
		 
	<!--  3) cart update -->
	<update id="updateCart" parameterType="java.util.Map">
		UPDATE shopping_cart SET cart_quantity = #{cartQuantity}
		WHERE cart_no = #{cartNo} AND customer_id = #{customerId}	
	</update>	
	 
	 
	<!--  2-2) cartOne (1개의 물품 수량정보만 불러오기) -->
	<select id="cartOneQty" resultType="goodee.gdj58.shop_c.vo.Cart">
		SELECT cart_quantity
		FROM shopping_cart
		WHERE cart_no = #{cartNo}  AND customer_id = #{customerId}
	</select>
	
	<!-- 2-1) cartlistOne -->
	<select id="cartOne" resultType="java.util.Map" >
		SELECT 
		c.cart_no cartNo
		, c.cart_quantity cartQuantity
		, co.company_name companyName
		, go.goods_option_no goodsOptionNo
		, g.goods_name goodsName
		, g.goods_price goodsPrice
		, gi.goods_img_save_name goodsImgSaveName
		FROM shopping_cart c
			INNER JOIN shopping_goods_option go ON c.goods_option_no = go.goods_option_no
			INNER JOIN shopping_goods_img gi ON go.goods_option_no = gi.goods_no
			INNER JOIN shopping_goods g ON gi.goods_no = g.goods_no
			INNER JOIN shopping_company co ON g.company_id= co.company_id
		WHERE c.customer_id = #{customerId} AND g.goods_no = #{goodsNo} 
	</select>
	 
	  
	<!--  2) cart list  -->
	<select id="cartList" resultType="java.util.Map" parameterType="String">
	
		SELECT 
		c.cart_no cartNo
		, c.cart_quantity cartQuantity
		, co.company_name companyName
		, go.goods_option_no goodsOptionNo
		, g.goods_No goodsNo
		, g.goods_name goodsName
		, g.goods_price goodsPrice
		, gi.goods_img_save_name goodsImgSaveName
		FROM shopping_cart c
			INNER JOIN shopping_goods_option go ON c.goods_option_no = go.goods_option_no
			INNER JOIN shopping_goods_img gi ON go.goods_option_no = gi.goods_no
			INNER JOIN shopping_goods g ON gi.goods_no = g.goods_no
			INNER JOIN shopping_company co ON g.company_id = co.company_id
		WHERE c.customer_id = #{customerId}
	</select>		
	
	<!--  1-1) cart 중복체크 -->
	<select id="cartListCk" resultType="goodee.gdj58.shop_c.vo.Cart" parameterType="int">
		SELECT * FROM shopping_cart
		WHERE customer_id = #{customerId}	
	</select>
	
	<!--  1) cart insert -->
	<insert id="insertCart" parameterType="goodee.gdj58.shop_c.vo.Cart">
		INSERT INTO shopping_cart(
			cart_no
			, goods_option_no
			, customer_id
			, cart_quantity
		) VALUES (
			#{cartNo}
			, #{goodsOptionNo}
			, #{customerId}
			, #{cartQuantity})	 		 
	</insert>		
</mapper>